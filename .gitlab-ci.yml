---
stages:
  - lint
  - test

ansible-lint:
  before_script:
    - apt-get update
    - apt-get install -y ansible ansible-lint yamllint flake8
    - yamllint --version
    - ansible-lint --version
  image: python:3-slim
  stage: lint
  script:
    - yamllint .
    - ansible-lint .

molecule:
  image: docker:stable-dind
  services:
    - docker:dind
  stage: test
  before_script:
    - apk add --no-cache
      python3 python3-dev py3-pip gcc git curl build-base
      autoconf automake py3-cryptography linux-headers
      musl-dev libffi-dev openssl-dev openssh
    - docker info
    - python3 --version
    - pip3 install -r test-requirements.txt
    - ansible --version
    - molecule --version
  script:
    - tox -e py38-ansible210 -- molecule test
